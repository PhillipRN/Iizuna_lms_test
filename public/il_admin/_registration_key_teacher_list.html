<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="utf-8">
    <meta name="robots" content="noindex">
    <title>管理画面</title>

    {include file='_favicon.html'}

    <link rel="stylesheet" href="../common/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="./common/style.css?202201292100" type="text/css">
    <link rel="stylesheet" href="./common/admin.css?202303261524" type="text/css">
    <script src="common/scripts/admin.js"></script>
</head>
<body>
<p style="margin: 10px;"><a href="index.php">戻る</a></p>
<hr />
<div id="contents">
    <div class="container-fluid">
        <div class="row">
            <div class="col-8"><h1>先生利用申請書籍キー管理</h1></div>
        </div>
    </div>

    <table class="table table-striped table-hover table-bordered">
        <thead>
        <tr>
            <th scope="col">登録日時</th>
            <th scope="col">学校/氏名</th>
            <th scope="col">書籍</th>
            <th scope="col">キー</th>
            <th scope="col">ステータス</th>
            <th scope="col">操作</th>
        </tr>
        </thead>
        <tbody>
        {foreach $registrationKeyList as $record name='loop'}
        <tr>
            <th scope="row">{$record.create_date|date_format:"%Y-%m-%d %T"}</th>
            <td>{$record.school_name}<br />
                {$record.name_1} {$record.name_2}</td>
            <td>{$record.name}</td>
            <td>{if empty($record.hash_key)}-{else}{$record.hash_key}{/if}</td>
            <td{if $record.key_status==1} class="bg-success text-white"{elseif $record.key_status==2} class="bg-secondary text-white"{/if}>{if $record.key_status==1}登録済{elseif $record.key_status==2}無効化{else}未登録{/if}</td>
            <td>{if empty($record.hash_key)}
                <form action="registration_key_regist.php" method="get">
                    <input type="hidden" name="teacher_id" value="{$record.teacher_id}" />
                    <input type="hidden" name="title_no" value="{$record.title_no}" />
                    <button type="submit" class="btn btn-outline-primary btn-sm">キー発行</button>
                </form>
                {else}
                {if $record.key_status==0}
                <button type="button" class="btn btn-outline-primary btn-sm" onclick="disableRegistrationKey({$record.key_id}, '{$record.hash_key}')">無効化</button>
                {else if $record.key_status!=1}
                <form action="registration_key_regist.php" method="get">
                    <input type="hidden" name="teacher_id" value="{$record.teacher_id}" />
                    <input type="hidden" name="title_no" value="{$record.title_no}" />
                    <button type="submit" class="btn btn-outline-primary btn-sm">キー再発行</button>
                </form>
                {/if}
                {/if}</td>
        </tr>
        {/foreach}
        </tbody>
    </table>
    <nav aria-label="...">
        <ul class="pagination pagination-sm">
{if $currentPage < 6}
{assign var=startPage value=1}
{assign var=endPage value=10}
{else}
{assign var=startPage value=$currentPage-5}
{assign var=endPage value=$currentPage+4}
{/if}
{if $endPage > $maxPageNum}
{assign var=endPage value=$maxPageNum}
{/if}

            {for $page=$startPage to $endPage}
            {if $page==$currentPage}
            <li class="page-item disabled">
                <a class="page-link">{$page}</a>
            </li>
            {else}
            <li class="page-item"><a class="page-link" href="registration_key_teacher_list.php?page={$page}">{$page}</a></li>
            {/if}
            {/for}
        </ul>
    </nav>
</div>
</body>
</html>
