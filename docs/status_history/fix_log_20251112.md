# 修正履歴（2025-11-12）

## 概要
- 事象: 傍線 `<u>` タグを含む選択肢で、正答でも不正解になる／結果画面に自分の選択肢が表示されない。
- 原因: `JsonQuizController::IsCorrectAnswer` が `strip_tags()` 後の文字列で比較しているため、下線位置だけが異なる選択肢が区別できない。
- 対応方針: 選択肢にユニークIDを付与し、IDベースで送受信・採点する計画を策定。

## 実施内容
1. `docs/answer_choice_id_migration_plan.md` を作成し、選択肢ID化に向けた移行計画を整理。
2. DynamoDB Local のセットアップ手順を `docs/dynamodb_local_setup.md` として整備し、student ログイン時のエラーを解消。
3. `BookLoader::FilterBookList()` を修正し、teacher 所持書籍が表示されない問題を解消。
4. `public/student/_index.html` の未初期化変数による Warning を修正。
5. `scripts/add_answer_choice_ids.php` を実装し、全クイズの `json_quiz` / `json_quiz_result` に `answer_id` をバックフィル。
6. Student クイズ送信／結果表示、および `JsonQuizController` / `TestController` を ID ベースで処理するよう全面改修。
7. `docs/summary_and_correct_answer_rate.md` を追加し、統計集計コマンドの実行手順とトラブルシュートを整備。
8. `app/Commands/CorrectAnswerRate.php` に summary/statistics の自動 INSERT と進捗ログ出力を実装し、quiz_id=1313 で検証。

## 今後のTODO
- 計画に沿って `json_quiz` / `json_quiz_result` のデータ移行スクリプトを実装。
- CSV→JSON コンバータ（`setup_database/iizuna_lms/converter.php`）に `answer_id` 生成を導入し、BookUpload からも自動付与できるようにする。
- CorrectAnswerRate / OnigiriCorrectAnswerRate を cron で安定実行できるようにし、警告ログ（compose / mbstring）も整理する。
- 傍線タグを含む設問での再現テストを継続。
